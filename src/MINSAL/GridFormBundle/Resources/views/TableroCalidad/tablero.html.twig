{% extends 'GridFormBundle::standard_layout.html.twig' %}
{% block stylesheets %}
    {{ parent() }}
    <style>
        .panel_{
            height: 350px !important;
            border: 1 solid red;
        }
        .glyphicon-off, .fa-user, .fa-caret-down{
            color: #FF7722;
        }
        TR{
            cursor: pointer;
        }
        .main-header{
            position: fixed;
            width: 100%;
        }
        .content-wrapper{
            padding-top: 30px;
        }
        .titulo_{
            color: white;
            font-weight: bolder;
            font-size: 18pt;
        }
        .content-wrapper, .right-side {
            background-color: white !important;
        }
        .main-header{
            background-color: #5D5D5D !important;
        }
        .axis path, .axis line {
            fill: none;
            stroke: #000;
            shape-rendering: crispEdges;
          }

          .bar {
            fill: #33B3EE;
          }

          .bar:hover {
            fill: #CCECFA ;
          }

          .x.axis path {
            display: none;
          }

          .d3-tip {
            line-height: 1;
            font-weight: bold;
            padding: 12px;
            background: rgba(0, 0, 0, 0.8);
            color: #fff;
            border-radius: 2px;
          }

          /* Creates a small triangle extender for the tooltip */
          .d3-tip:after {
            box-sizing: border-box;
            display: inline;
            font-size: 10px;
            width: 100%;
            line-height: 1;
            color: rgba(0, 0, 0, 0.8);
            content: "\25BC";
            position: absolute;
            text-align: center;
          }

          /* Style northward tooltips differently */
          .d3-tip.n:after {
            margin: -1px 0 0 0;
            top: 100%;
            left: 0;
          }
        DIV.row_tablero {
            height: 350px !important;
        }
        .listado .panel-body{
            max-height: 290px !important;
            overflow-y: auto;
        }
        .separador {
            background-color: #D6D6D6;
        }
        .indentacion_1 {
            padding-left: 20px !important;
        }
        .indentacion_2 {
            padding-left: 40px !important;
        }
        .indentacion_2 {
            padding-left: 60px !important;
        }
    </style>
{% endblock %}
{% block javascripts %}    
    {{parent()}}
    <script type="text/javascript" src="{{ asset('bundles/indicadores/js/d3.v3.min.js') }}" ></script>
    <!--<script type="text/javascript" src="{{ asset('bundles/indicadores/js/topojson.v1.min.js') }}" ></script> -->
    
    <script type="text/javascript" src="{{ asset('bundles/gridform/js/angular.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/gridform/js/d3tip.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/gridform/js/angular-resource.min.js') }}"></script>
    
    <script type="text/javascript" src="{{ asset('bundles/gridform/js/TableroCalidad/barchart.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/gridform/js/TableroCalidad/radarchart.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/gridform/js/TableroCalidad/linechart.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/gridform/js/TableroCalidad/app.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/gridform/js/TableroCalidad/servicios.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/gridform/js/TableroCalidad/barchartComponent.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/gridform/js/TableroCalidad/radarchartComponent.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/gridform/js/TableroCalidad/linechartComponent.js') }}"></script>
    
{% endblock %}

{% block content %}
    <div >
        <div class="row row_tablero" >
            <DIV class="col-md-6 listado">
                <div class="panel panel-info panel_" >
                    <!-- Default panel contents -->
                    <div class="panel-heading">
                        <div class="form_row row">
                            <div class="col-md-4">
                                <strong>{{'_periodo_evaluacion_'|trans}}</strong>
                                <select class="form-control"  
                                        data-ng-options="periodo as periodo.etiqueta for periodo in periodos track by periodo.periodo" 
                                        ng-model="periodoSeleccionado" ng-change="getEstablecimientos(periodoSeleccionado)" required >
                                </select>                                
                            </div>
                            <div class="col-md-4">
                                <!-- 
                                <button ng-click="update()" class="btn btn-success">+10</button>
                                <button ng-click="update()" class="btn btn-danger">-10</button>
                                <button ng-click="update()" class="btn btn-primary">{{'_todos_'|trans}}</button> -->
                            </div> 
                            <div class="col-md-4">
                                <div class="input-group">
                                    <div class="input-group-addon"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></div>
                                    <input type="text" class="form-control" size="10" ng-model="buscar" >
                                </div>
                            </div>
                                
                        </div>
                    </div>
                    <div class="panel-body">                        
                        <div class="alert alert-warning" role="alert" ng-show="!establecimientos.length">{{'_no_hay_datos_mostrar_'|trans}}</div>
                        <table class="table table-hover" ng-show="establecimientos.length">
                            <thead>
                                <TR>
                                    <TD>{{'_establecimiento_'|trans}}</TD>
                                    <TD>{{'_cumplimiento_'|trans}}</TD>
                                </TR>
                            </thead>
                            <tbody>
                                <TR  ng-repeat="est in establecimientos | filter : buscar"  ng-click="getEvaluaciones(est)" >
                                    <TD >( [[est.id_establecimiento]] ) [[est.nombre]]</TD>
                                    <TD>[[est.total_cumplimiento]]/[[est.total_aplicable]] = [[est.measure]]%</TD>
                                </TR>
                            </tbody>
                        </table>                        
                    </div>

                    
                </div>
            </div>
            <div class="col-md-6">
                <div class="panel panel-info panel_" > 
                    <div class="panel-heading">
                        <strong>[[titulo_grafico1]]</strong>
                    </div>
                    <div class="panel-body">
                        <bar-chart height="options.height" data="datosGrafico1" ></bar-chart>
                    </div>                
                </div>
            </div>
        </div>
        <!-- segunda fila -->
        <div class="row row_tablero" ng-show="evaluaciones.length">
            <DIV class="col-md-6 listado" id="evaluacionesList">
                <div class="panel panel-info panel_" >
                    <div class="panel-heading">
                        <div class="form_row row">                            
                            <DIV class="col-md-4"><strong>{{'_evaluaciones_'|trans}}</strong></div>
                            <DIV class="col-md-4"></div>
                            <DIV class="col-md-4">
                                <div class="input-group">
                                    <div class="input-group-addon"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></div>
                                    <input type="text" class="form-control" size="10" ng-model="buscar_evaluaciones" >
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="panel-body">                        
                        <div class="alert alert-warning" role="alert" ng-show="!evaluaciones.length">{{'_no_hay_datos_mostrar_'|trans}}</div>
                        <table class="table table-hover" ng-show="evaluaciones.length">
                            <thead>
                                <TR>
                                    <TD>{{'_nombre_'|trans}}</TD>
                                    <TD>{{'_descripcion_'|trans}}</TD>
                                    <TD>{{'_calificacion_'|trans}}</TD>
                                    <TD>{{'_estandar_'|trans}}</TD>
                                    <TD>{{'_brecha_'|trans}}</TD>
                                </TR>
                            </thead>
                            <tbody>
                                <TR  ng-repeat="eval in evaluaciones | filter : buscar_evaluaciones" ng-click="getCriterios(eval)">
                                    <TD  >[[eval.nombre_evaluacion]]</TD>
                                    <TD >[[eval.descripcion]]</TD>
                                    <TD>[[eval.total_cumplimiento]]/[[eval.total_aplicable]] = [[eval.measure | number:2]]%</TD>
                                    <TD>[[eval.meta*100 | number:2 ]]%</TD>
                                    <TD>[[eval.brecha*100 | number:2 ]]%</TD>
                                </TR>
                            </tbody>
                        </table>                        
                    </div>

                    
                </div>
            </div>
            <div class="col-md-6">
                <div class="panel panel-info panel_" >
                    <div class="panel-body">
                        <input type="checkbox" checked="checked" value="estandar"/>{{'_estandar_'|trans}}
                        <input type="checkbox" checked="checked" value="brecha"/>{{'_brecha_'|trans}}
                        <radar-chart data="datosGrafico2" ></radar-chart>
                    </div>                
                </div>
            </div>
        </div>
        <!-- tercera fila -->
        <div class="row" ng-show="criterios.length"  >
            <DIV class="col-md-12">
                <div class="panel panel-info" >
                    <div class="panel-heading">
                        <div class="form_row row">                            
                            <DIV class="col-md-8"><strong>[[evaluacionSeleccionada.descripcion]]</strong></div>
                            <DIV class="col-md-4">
                                <div class="input-group">
                                    <div class="input-group-addon"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></div>
                                    <input type="text" id="criteriosList" class="form-control" size="30" ng-model="buscar_criterios" >
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="panel-body">
                        <div class="alert alert-warning" role="alert" ng-show="!criterios.length">{{'_no_hay_datos_mostrar_'|trans}}</div>
                        <TABLE CLASS="table table-hover">
                            <!-- <thead>
                                <TR>
                                    <TD>{{'_nombre_evaluacion_'|trans}}</TD>
                                    <TD>{{'_descripcion_'|trans}}</TD>
                                    <TD>{{'_cumplimiento_'|trans}}</TD>
                                </TR>
                            </thead> -->
                            <TBODY>
                                <!--<respuestas evaluacion='evaluacionSeleccionada' periodo='periodoSeleccionado' data='criterios' ></respuestas> -->
                                <TR  class="fila_criterios" ng-repeat="criterio in criterios | filter : buscar_criterios" >
                                    <TD class="separador indentacion_[[criterio.nivel_indentacion]]" 
                                        ng-if="criterio.es_separador == 'true'" colspan="2" >
                                        [[criterio.descripcion_variable]]
                                    </TD>
                                    <TD class="indentacion_[[criterio.nivel_indentacion]]" ng-if="criterio.es_separador != 'true'" >
                                        [[criterio.descripcion_variable]]
                                    </TD>
                                    <TD ng-if="evaluacionSeleccionada.periodo_lectura_datos =='anual' && criterio.es_separador != 'true' "  >
                                        <button class="btn btn-success" ng-if="getValorMes(criterio)=='true'">
                                            <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
                                        </button>
                                        <button class="btn btn-danger " ng-if="getValorMes(criterio)=='false' || getValorMes(criterio)==''">
                                            <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                                        </button>
                                        <span ng-if="getValorMes(criterio) != 'false' && getValorMes(criterio) != 'true'">[[getValorMes(criterio)]]</span>
                                    </TD>
                                    
                                    <TD ng-if="evaluacionSeleccionada.periodo_lectura_datos =='mensual' && criterio.es_separador != 'true' "  
                                        ng-repeat="exp in getExpedientes(criterio)"
                                        > 
                                        <button class="btn btn-success" ng-if="getValorExpediente(exp)=='true'">
                                            <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
                                        </button>
                                        <button class="btn btn-danger" ng-if="getValorExpediente(exp)=='false' || getValorExpediente(exp)==''">
                                            <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                                        </button>
                                        <span ng-if="getValorExpediente(exp) != 'false' && getValorExpediente(exp) != 'true'">[[getValorExpediente(exp)]]</span>
                                    </TD>
                                </TR>
                            </tbody>
                        </TABLE>
                    </div>

                    
                </div>
            </div>            
        </div>
    </div>
{% endblock content%}